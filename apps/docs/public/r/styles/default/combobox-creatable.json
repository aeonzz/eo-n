{
  "name": "combobox-creatable",
  "type": "registry:example",
  "files": [
    {
      "path": "examples/combobox-creatable.tsx",
      "content": "import * as React from \"react\";\r\nimport { Plus } from \"lucide-react\";\r\n\r\nimport { Button } from \"@/registry/default/ui/button\";\r\nimport {\r\n  Combobox,\r\n  ComboboxChip,\r\n  ComboboxChips,\r\n  ComboboxContent,\r\n  ComboboxEmpty,\r\n  ComboboxInput,\r\n  ComboboxItem,\r\n  ComboboxList,\r\n  ComboboxValue,\r\n} from \"@/registry/default/ui/combobox\";\r\nimport {\r\n  Dialog,\r\n  DialogClose,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from \"@/registry/default/ui/dialog\";\r\nimport { Input } from \"@/registry/default/ui/input\";\r\nimport { Label } from \"@/registry/default/ui/label\";\r\n\r\ninterface TagItem {\r\n  creatable?: string;\r\n  value: string;\r\n  label: string;\r\n}\r\n\r\nconst initialTags: TagItem[] = [\r\n  { value: \"work\", label: \"work\" },\r\n  { value: \"personal\", label: \"personal\" },\r\n  { value: \"ideas\", label: \"ideas\" },\r\n  { value: \"important\", label: \"important\" },\r\n  { value: \"later\", label: \"read later\" },\r\n];\r\n\r\nexport default function ComboboxMultiSelect() {\r\n  const containerRef = React.useRef<HTMLDivElement | null>(null);\r\n  const createInputRef = React.useRef<HTMLInputElement | null>(null);\r\n  const comboboxInputRef = React.useRef<HTMLInputElement | null>(null);\r\n  const pendingQueryRef = React.useRef(\"\");\r\n\r\n  const [tags, setTags] = React.useState<TagItem[]>(initialTags);\r\n  const [selected, setSelected] = React.useState<TagItem[]>([]);\r\n  const [query, setQuery] = React.useState(\"\");\r\n  const [openDialog, setOpenDialog] = React.useState(false);\r\n\r\n  function handleCreate() {\r\n    const input = createInputRef.current || comboboxInputRef.current;\r\n    const value = input ? input.value.trim() : \"\";\r\n    if (!value) {\r\n      return;\r\n    }\r\n\r\n    const normalized = value.toLocaleLowerCase();\r\n    const baseValue = normalized.replace(/\\s+/g, \"-\");\r\n    const existing = tags.find(\r\n      (l) => l.value.trim().toLocaleLowerCase() === normalized\r\n    );\r\n\r\n    if (existing) {\r\n      setSelected((prev) =>\r\n        prev.some((i) => i.value === existing.value)\r\n          ? prev\r\n          : [...prev, existing]\r\n      );\r\n      setOpenDialog(false);\r\n      setQuery(\"\");\r\n      return;\r\n    }\r\n\r\n    // Ensure we don't collide with an existing value (e.g., value \"docs\" vs. existing value \"docs\")\r\n    const existingIds = new Set(tags.map((l) => l.value));\r\n    let uniqueValue = baseValue;\r\n    if (existingIds.has(uniqueValue)) {\r\n      let i = 2;\r\n      while (existingIds.has(`${baseValue}-${i}`)) {\r\n        i += 1;\r\n      }\r\n      uniqueValue = `${baseValue}-${i}`;\r\n    }\r\n\r\n    const newItem: TagItem = { value: uniqueValue, label: value };\r\n\r\n    if (!selected.find((item) => item.value === newItem.value)) {\r\n      setTags((prev) => [...prev, newItem]);\r\n      setSelected((prev) => [...prev, newItem]);\r\n    }\r\n\r\n    setOpenDialog(false);\r\n    setQuery(\"\");\r\n  }\r\n\r\n  function handleCreateSubmit(event: React.FormEvent<HTMLFormElement>) {\r\n    event.preventDefault();\r\n    handleCreate();\r\n  }\r\n\r\n  const trimmed = query.trim();\r\n  const lowered = trimmed.toLocaleLowerCase();\r\n  const exactExists = tags.some(\r\n    (l) => l.value.trim().toLocaleLowerCase() === lowered\r\n  );\r\n  // Show the creatable item alongside matches if there's no exact match\r\n  const itemsForView: Array<TagItem> =\r\n    trimmed !== \"\" && !exactExists\r\n      ? [\r\n          ...tags,\r\n          {\r\n            creatable: trimmed,\r\n            value: `create:${lowered}`,\r\n            label: `Create \"${trimmed}\"`,\r\n          },\r\n        ]\r\n      : tags;\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Combobox\r\n        items={itemsForView}\r\n        multiple\r\n        onValueChange={(next) => {\r\n          const last = next[next.length - 1];\r\n          if (last && last.creatable) {\r\n            pendingQueryRef.current = last.creatable;\r\n            setOpenDialog(true);\r\n            return;\r\n          }\r\n          const clean = next.filter((i) => !i.creatable);\r\n          setSelected(clean);\r\n          setQuery(\"\");\r\n        }}\r\n        value={selected}\r\n        inputValue={query}\r\n        onInputValueChange={setQuery}\r\n        onOpenChange={(open, details) => {\r\n          if (\"key\" in details.event && details.event.key === \"Enter\") {\r\n            // When pressing Enter:\r\n            // - If the typed value exactly matches an existing item, add that item to the selected chips\r\n            // - Otherwise, create a new item\r\n            if (trimmed === \"\") {\r\n              return;\r\n            }\r\n\r\n            const existing = tags.find(\r\n              (l) => l.value.trim().toLocaleLowerCase() === lowered\r\n            );\r\n\r\n            if (existing) {\r\n              setSelected((prev) =>\r\n                prev.some((i) => i.value === existing.value)\r\n                  ? prev\r\n                  : [...prev, existing]\r\n              );\r\n              setQuery(\"\");\r\n              return;\r\n            }\r\n\r\n            pendingQueryRef.current = trimmed;\r\n            setOpenDialog(true);\r\n          }\r\n        }}\r\n        autoHighlight\r\n      >\r\n        <div className=\"flex w-full max-w-sm flex-col gap-2\">\r\n          <Label htmlFor=\"tags\">Tags</Label>\r\n          <ComboboxChips ref={containerRef}>\r\n            <ComboboxValue>\r\n              {(value: TagItem[]) => (\r\n                <React.Fragment>\r\n                  {value.map((item) => (\r\n                    <ComboboxChip key={item.value} aria-label={item.label}>\r\n                      {item.label}\r\n                    </ComboboxChip>\r\n                  ))}\r\n                  <ComboboxInput\r\n                    ref={comboboxInputRef}\r\n                    id=\"tags\"\r\n                    placeholder={value.length > 0 ? \"\" : \"e.g. work\"}\r\n                  />\r\n                </React.Fragment>\r\n              )}\r\n            </ComboboxValue>\r\n          </ComboboxChips>\r\n        </div>\r\n        <ComboboxContent anchor={containerRef} sideOffset={6}>\r\n          <ComboboxEmpty>No language found.</ComboboxEmpty>\r\n          <ComboboxList>\r\n            {(item: TagItem) =>\r\n              item.creatable ? (\r\n                <ComboboxItem key={item.value} value={item}>\r\n                  {item.label}\r\n                  <Plus className=\"absolute right-2\" />\r\n                </ComboboxItem>\r\n              ) : (\r\n                <ComboboxItem key={item.value} value={item}>\r\n                  {item.label}\r\n                </ComboboxItem>\r\n              )\r\n            }\r\n          </ComboboxList>\r\n        </ComboboxContent>\r\n      </Combobox>\r\n      <Dialog open={openDialog} onOpenChange={setOpenDialog}>\r\n        <DialogContent\r\n          initialFocus={createInputRef}\r\n          className=\"sm:max-w-[425px]\"\r\n        >\r\n          <DialogHeader>\r\n            <DialogTitle>Create new tag</DialogTitle>\r\n            <DialogDescription>Add a new tag to select.</DialogDescription>\r\n          </DialogHeader>\r\n          <form onSubmit={handleCreateSubmit} className=\"flex flex-col gap-4\">\r\n            <Input\r\n              ref={createInputRef}\r\n              placeholder=\"Tag name\"\r\n              defaultValue={pendingQueryRef.current}\r\n            />\r\n            <DialogFooter>\r\n              <DialogClose render={<Button variant=\"outline\">Cancel</Button>} />\r\n              <Button type=\"submit\">Create</Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </React.Fragment>\r\n  );\r\n}\r\n",
      "type": "registry:example",
      "target": ""
    }
  ]
}